(function(a){a.fn.extend({FullCalendarExt:function(b){function c(b,c){t(c,["all-day","categorie","categories","category","color","description","description_editable","end","start","id","repeat_id","repeat_type","title","url","user_id"]);var d="";a.getJSON(j.jsonConfig).then(function(g){if(0<a(".custom-fields").children().length&&0<Object.keys(c).length)for(var h in Object.keys(c).every(function(a){return""===c[a]||null===c[a]})||(d="<hr />"),c){var j=c[h],k=[];"file"==h&&(void 0!==j&&"undefined"!==j&&""!==j?/\.(gif|jpg|jpeg|tiff|png)$/i.test(j)?j="<a target=\"_blank\" href=\""+j+"\"><img src=\""+j+"\" class=\"img-responsive\" /></a>":j="<a target=\"_blank\" href=\""+j+"\">"+j+"</a>":j="");var l=e(g,"<"+h+">");if(0<j.length||a.isArray(j)&&null!==j)if(a.isArray(j)&&null!==j){for(var m=0;m<j.length;m++)k.push(f(g,j[m]));d+="<h5><strong>"+l+"</strong></h5><p>"+k.join(", ")+"</p><p class=\"custom-field-sep\" style=\"margin-bottom: 0; height: 2px;\">&nbsp;</p>"}else j&&(d+="<h5><strong>"+l+"</strong></h5><p>"+j+"</p><p class=\"custom-field-sep\" style=\"margin-bottom: 0; height: 2px;\">&nbsp;</p>")}a("#details-body-content").html(b+d)}).fail(function(){a("#details-body-content").html(b)})}function d(){a("#modal-form-body :input").each(function(){var b=a(this).attr("name"),c=a(this)[0].tagName;switch(c){case"SELECT":var d=k.data[b];d!==void 0&&a("option[value=\""+d.replace("&amp;","&")+"\"]").attr("selected","selected");break;case"INPUT":var b=b.replace(/\[.*?\]/g,""),e=a(this).attr("type"),d=k.data[b];if("checkbox"==e&&void 0!==d)for(var f=d,g=0;g<f.length;g++)a("input[value=\""+f[g]+"\"]").prop("checked",!0);"radio"==e&&d!==void 0&&a("input[value=\""+d+"\"]").prop("checked",!0),"file"==e&&d!==void 0&&"undefined"!==d&&a(this).before("<p class=\"file-attachment\"><a target=\"_blank\" href=\""+d+"\">"+d+"</a></p>"),"text"==e&&(a("input[name=\""+b+"\"]").val(k.data[b]),a("input[name=title]").val(k.data.title),a("#colorp").spectrum("set",k.data.color),a("#startDate").val(k.d_startDate),a("input#startTime").val(k.d_startTime),a("#endDate").val(k.d_endDate),a("input#endTime").val(k.d_endTime));break;case"TEXTAREA":var d=k.data[b];a("textarea[name=\""+b+"\"]").val(d),a("textarea[name=\"description\"]").val(k.data.description_editable);break;default:a(":input[name=\""+b+"\"]").val(k.data[b]);}})}function e(a,b){var c="";for(var d in a)if(a.hasOwnProperty(d)){var e=a[d].fields;for(var f in e)e.hasOwnProperty(f)&&Object.keys(e).forEach(function(a){return!!(e[a].includes(b)||e[a].includes(b.replace(">","[]>")))&&void(c=a)})}return c}function f(a,b){var c=[];for(var d in a)a.hasOwnProperty(d)&&("object"==typeof a[d]?c=c.concat(f(a[d],b)):d==b&&c.push(a[d]));return c}var g="token="+a("#cal_token").val(),h={calendarSelector:"#calendar",loadingSelector:"#loading",lang:"en",token:"",ajaxJsonFetch:"includes/cal_events.php?"+g,ajaxUiUpdate:"includes/cal_update.php?"+g,ajaxEventQuickSave:"includes/cal_quicksave.php?"+g,ajaxEventDelete:"includes/cal_delete.php?"+g,ajaxEventEdit:"includes/cal_edit_update.php?"+g,ajaxEventExport:"includes/cal_export.php?"+g,ajaxRepeatCheck:"includes/cal_check_rep_events.php?"+g,ajaxRetrieveDescription:"includes/cal_description.php?"+g,ajaxImport:"importer.php?"+g,jsonConfig:"includes/form.json",modalSelector:"#calendarModal",modalPromptSelector:"#cal_prompt",modalEditPromptSelector:"#cal_edit_prompt_save",formAddEventSelector:"form#add_event",formFilterSelector:"form#filter-category select",formSearchSelector:"form#search",newEventText:"Add New Event",successAddEventMessage:"Successfully Added Event",successDeleteEventMessage:"Successfully Deleted Event",successUpdateEventMessage:"Successfully Updated Event",failureAddEventMessage:"Failed To Add Event",failureDeleteEventMessage:"Failed To Delete Event",failureUpdateEventMessage:"Failed To Update Event",generalFailureMessage:"Failed To Execute Action",ajaxError:"Failed to load content",emptyForm:"Form cannot be empty",unableToOpenEvent:"Something went wrong. Unable to open event",eventText:"Event: ",repetitiveEventActionText:"This is a repetitive event, what do you want to do?",isRTL:!1,weekNumberTitle:"W",defaultColor:"#587ca3",weekType:"agendaWeek",dayType:"agendaDay",listType:"listWeek",editable:!0,ignoreTimezone:!0,lazyFetching:!0,filter:!0,quickSave:!0,navLinks:!0,firstDay:0,gcal:!1,gcalUrlText:"View on Google",version:"modal",defaultView:"month",aspectRatio:1.35,weekends:!0,weekNumbers:!1,weekNumberCalculation:"iso",hiddenDays:[],theme:!1,themePrev:"circle-triangle-w",themeNext:"circle-triangle-e",titleFormatMonth:"",titleFormatWeek:"",titleFormatDay:"",columnFormatMonth:"",columnFormatWeek:"",columnFormatDay:"",timeFormat:"H:mm",weekMode:!0,allDaySlot:!0,allDayText:"all-day",axisFormat:"h(:mm)a",slotDuration:"00:30:00",minTime:"00:00:00",maxTime:"24:00:00",nextDayThreshold:"00:00:00",slotEventOverlap:!0,enableDrop:!0,enableResize:!0,savedRedirect:"index.php",removedRedirect:"index.php",updatedRedirect:"index.php",ajaxLoaderMarkup:"<div class=\"loadingDiv\"></div>",prev:"left-single-arrow",next:"right-single-arrow",prevYear:"left-double-arrow",nextYear:"right-double-arrow",otherSource:!1,modalFormBody:a("#modal-form-body").html(),icons_title:!1,fc_extend:{},eventLimit:!0,eventLimitClick:"popover",palette:[["#0b57a4","#8bbdeb","#000000","#2a82d7","#148aa5","#3714a4","#587ca3","#a50516"],["#fb3c8f","#1b4f15","#1b4f15","#686868","#3aa03a","#ff0080","#fee233","#fc1cad"],["#7f2b14","#000066","#2b4726","#fd7222","#fc331c","#af31f2","#fc0d1b","#2b8a6d"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"]]},i=a.extend(h,b),j=i;!0==j.gcal&&(j.weekType="",j.dayType="");var k={},l={locale:j.lang,editable:j.editable,eventLimit:j.eventLimit,eventLimitClick:j.eventLimitClick,navLinks:j.navLinks,defaultView:j.defaultView,aspectRatio:j.aspectRatio,weekends:j.weekends,weekNumbers:j.weekNumbers,weekNumberCalculation:j.weekNumberCalculation,weekNumberTitle:j.weekNumberTitle,views:{month:{titleFormat:j.titleFormatMonth,columnFormat:j.columnFormatMonth},week:{titleFormat:j.titleFormatWeek,columnFormat:j.columnFormatWeek},day:{titleFormat:j.titleFormatDay,columnFormat:j.columnFormatDay}},isRTL:j.isRTL,hiddenDays:j.hiddenDays,theme:j.theme,buttonIcons:{prev:j.prev,next:j.next,prevYear:j.prevYear,nextYear:j.nextYear},themeButtonIcons:{prev:j.themePrev,next:j.themeNext},allDaySlot:j.allDaySlot,allDayText:j.allDayText,slotLabelFormat:j.axisFormat,slotDuration:j.slotDuration,minTime:j.minTime,maxTime:j.maxTime,slotEventOverlap:j.slotEventOverlap,fixedWeekCount:j.weekMode,timeFormat:j.timeFormat,header:{left:"prev,next",center:"title",right:"month,"+j.weekType+","+j.dayType+","+j.listType},monthNames:j.monthNames,monthNamesShort:j.monthNamesShort,dayNames:j.dayNames,dayNamesShort:j.dayNamesShort,buttonText:{today:j.today,month:j.month,week:j.week,day:j.day},ignoreTimezone:j.ignoreTimezone,firstDay:j.firstDay,lazyFetching:j.lazyFetching,selectable:j.quickSave,selectHelper:j.quickSave,eventStartEditable:j.enableDrop,eventDurationEditable:j.enableResize,nextDayThreshold:j.nextDayThreshold,loading:function(b){!1==b?a(j.loadingSelector).hide():!0==b&&a(j.loadingSelector).show()},select:function(b,c,d,e){calendar.view=e.name,"modal"==j.version&&(calendar.quickModal(b,c,d),a(j.calendarSelector).fullCalendar("unselect")),"month"!==e.name&&moment(b._d).format("HH:mm")!==moment(c._d).format("HH:mm")&&(a("#event-type option[value=\"false\"]").prop("selected",!0),a("#event-type-select").show(),a("#event-type-selected").show())},eventSources:[j.otherSource,{url:j.ajaxJsonFetch}],eventDrop:function(b){var c=moment(b.start).format("YYYY-MM-DD"),d=moment(b.start).format("HH:mm"),e=moment(b.end).format("YYYY-MM-DD"),f=moment(b.end).format("HH:mm"),g=moment(b.end).isValid();null===b.end||"null"===b.end||!1==g?(Eend=c+" "+d,EaD=b.allDay):(Eend=e+" "+f,EaD=b.allDay);var h="title="+encodeURIComponent(b.title)+"&start="+c+" "+d+"&end="+Eend+"&id="+b.id+"&allDay="+EaD+"&original_id="+b.original_id;a.post(j.ajaxUiUpdate,h,function(){a(j.calendarSelector).fullCalendar("refetchEvents")})},eventResize:function(b){var c=moment(b.start).format("YYYY-MM-DD"),d=moment(b.start).format("HH:mm"),e=moment(b.end).format("YYYY-MM-DD"),f=moment(b.end).format("HH:mm"),g=moment(b.end).isValid();null===b.end||"null"===b.end||!1==g?(Eend=c+" "+d,EaD="false"):(Eend=e+" "+f,EaD=b.allDay);var h="title="+encodeURIComponent(b.title)+"&start="+c+" "+d+"&end="+Eend+"&id="+b.id+"&allDay="+EaD+"&original_id="+b.original_id;a.post(j.ajaxUiUpdate,h,function(){a(j.calendarSelector).fullCalendar("refetchEvents")})},eventRender:function(a,b,c){if(b.attr("href"))b.attr("data-toggle","modal"),b.attr("href","javascript:void(0)"),b.attr("onclick","calendar.openModalGcal(\""+encodeURI(a.title)+"\",\""+a.url+"\");");else{if(!0==j.icons_title){var d=b.find(".fc-title").text(),e=d.replace(/\[(.*?)\]/gi,"<i class=\"$1\"></i>");b.find(".fc-title").html(e)}var f=a.color,g=moment(a.start).format("YYYY-MM-DD"),h=moment(a.start).format("HH:mm"),i=moment(a.end).format("YYYY-MM-DD"),k=moment(a.end).format("HH:mm"),l=moment(a.end).isValid();if(!1==l)var i=g,k=h;null!==a.end&&"month"==c.name&&("H:mm"==j.timeFormat||"h:mm"==j.timeFormat)&&(timeformat=a.start.format("H:mm")+" - "+a.end.format("H:mm"),b.find(".fc-time").html(timeformat)),"modal"==j.version&&(b.attr("data-toggle","modal"),b.attr("href","javascript:void(0)"),b.attr("data-id",a.original_id),b.attr("data-rep_id",a.id),b.attr("data-title",encodeURIComponent(a.title)),b.attr("data-url",encodeURIComponent(a.url)),b.attr("data-eventstart",a.start),b.attr("data-eventend",a.end),b.attr("data-color",f),b.attr("data-d_startdate",g),b.attr("data-d_starttime",h),b.attr("data-d_enddate",i),b.attr("data-d_endtime",k),b.attr("onclick","calendar.openModal(this)"))}Object.freeze(calendar)}},m=a.extend(l,j.fc_extend);a(j.calendarSelector).fullCalendar(m),calendar.openModal=function(b){k.id=a(b).data("id"),k.rep_id=a(b).data("rep_id"),k.title=a(b).data("title"),k.url=a(b).data("url"),k.eventStart=a(b).data("eventstart"),k.eventEnd=a(b).data("eventend"),k.color=a(b).data("color"),k.d_startDate=a(b).data("d_startdate"),k.d_startTime=a(b).data("d_starttime"),k.d_endDate=a(b).data("d_enddate"),k.d_endTime=a(b).data("d_endtime"),!0==j.icons_title?(k.title=k.title.replace(/\[(.*?)\]/gi,"<i class=\"$1\"></i>"),k.title=decodeURIComponent(k.title)):k.title=decodeURIComponent(k.title),a("#modal-form-body").hide(),a("#details-body").show(),k.ExpS=k.d_startDate+" "+k.d_startTime,k.ExpE=k.d_endDate+" "+k.d_endTime,a.ajax({type:"POST",url:j.ajaxRetrieveDescription,data:{id:k.id,title:encodeURIComponent(k.title),start:k.d_startDate,mode:"edit"},cache:!1,beforeSend:function(){a(".loadingDiv").show(),a(".modal-footer").hide()},error:function(){a(".loadingDiv").hide(),console.log(j.ajaxError)},success:function(b){if(b){a(".loadingDiv").hide();var d=JSON.parse(b),e=d.description.replace("$null",""),f=d.color.replace("$null",""),g=d.category.replace("$null","");k.description_editable=d.description_editable.replace("&amp;","&"),k.description=e.replace("&amp;","&"),k.category=g.replace("&amp;","&"),k.color=f,k.data=d;var h=JSON.parse(JSON.stringify(d));a("#details-body-title").html(k.title),c(e,h),a("#export-event, #delete-event, #edit-event").show(),a("#save-changes, #add-event").hide(),a(".modal-footer").show(),a(j.modalSelector).modal("show")}else alert(j.unableToOpenEvent)}}),a("#delete-event").off().on("click",function(a){q(k.id),a.preventDefault()}),a("#export-event").off().on("click",function(a){s(k.id,k.title,k.ExpS,k.ExpE),a.preventDefault()}),a("#edit-event").off().on("click",function(){document.getElementById("modal-form-body").reset(),a("#modal-form-body").html(j.modalFormBody),a("#export-event, #delete-event, #edit-event, #add-event").hide(),a("#save-changes").show().css("width","100%"),a("#details-body, #event-type-select").hide(),a("#repeat-type-select, #repeat-type-selected").hide(),a("#event-type-selected").show(),a("#modal-form-body").show(),a(j.modalSelector).modal("show"),d(),a("#save-changes").off().on("click",function(b){if(0==a("input[name=title]").val().length)alert(j.emptyForm);else{editFormData=new FormData;var c=a("#modal-form-body").serializeArray();a.each(c,function(b,c){if(a.isArray(c.value))for(var d=0;d<c.value.length;d++)editFormData.append(c.name+"[]",c.value[d]);else editFormData.append(c.name,c.value)});var d=a("#modal-form-body").find("input[type=checkbox]");a.each(d,function(b,c){a(this).is(":checked")||editFormData.append(a(c).attr("name"),"")}),a("#file")[0]&&a("#file")[0].files[0]!==void 0&&"undefined"!==a("#file")[0].files[0]&&editFormData.append("file",a("#file")[0].files[0]),o(k.id,editFormData)}b.preventDefault()})})},calendar.data=function(){var a={id:k.id,title:k.title,url:k.url,start:k.eventStart,end:k.eventEnd,description:k.description,color:k.color};return a},calendar.openModalGcal=function(b,c){a("#modal-form-body").hide(),a("#details-body").show(),a("#details-body-title").html(b),a("#details-body-content").html("<a target=\"_blank\" href=\""+c+"\">"+j.gcalUrlText+"</a>"),a("#export-event, #delete-event, #edit-event").hide(),a("#save-changes, #add-event").hide(),a(".modal-footer").hide(),a(j.modalSelector).modal("show")},calendar.quickModal=function(b,c){document.getElementById("modal-form-body").reset(),a("#modal-form-body").html(j.modalFormBody);var d=moment(b).format("YYYY-MM-DD"),e=moment(b).format("HH:mm"),f=moment(c).format("YYYY-MM-DD"),g=moment(c).format("HH:mm"),h=moment(c).isValid();if(!1==h)var f=d,g=e;a("#startDate").val(d),a("#startTime").val(e),a("#endDate").val(f),a("#endTime").val(g),a("#details-body").hide(),a("#event-type-select").show(),a("#event-type-selected").hide(),a("#repeat-type-select").show(),a("#repeat-type-selected").hide(),a("#export-event, #delete-event, #edit-event, #save-changes").hide(),a("#add-event").show().css("width","100%"),a(".modal-footer").show(),a("#modal-form-body").show(),a("#details-body-title").html(j.newEventText),a(j.modalSelector).modal("show"),a("#event-type").on("change",function(){var b=a(this).val();"false"==b?(a("#event-type-select").show(),a("#event-type-selected").show()):"true"==b&&(a("#event-type-select").show(),a("#event-type-selected").hide())}),a("#repeat_select").on("change",function(){var b=a(this).val();"no"===b?"no"==b&&(a("#repeat-type-select").show(),a("#repeat-type-selected").hide()):(a("#repeat-type-select").show(),a("#repeat-type-selected").show())}),a("#colorp").spectrum("set",j.defaultColor),a("#add-event").off().on("click",function(b){0==a("input[name=title]").val().length?alert(j.emptyForm):(formData=new FormData(a("#modal-form-body").get(0)),a("#file")[0]&&formData.append("file",a("#file")[0].files[0]),n(formData)),b.preventDefault()})};var n=function(b){a.ajax({url:j.ajaxEventQuickSave,data:b,type:"POST",cache:!1,processData:!1,contentType:!1,beforeSend:function(){a(".loadingDiv").show(),a(".modal-footer").hide()},error:function(){a(".loadingDiv").hide(),console.log(j.ajaxError)},success:function(b){a(".loadingDiv").hide(),1==b?(a(j.modalSelector).modal("hide"),a(j.calendarSelector).fullCalendar("refetchEvents")):(alert(j.failureAddEventMessage),a(".modal-footer").show())}})},o=function(b,c){a.ajax({type:"POST",url:j.ajaxRepeatCheck,data:"id="+b,cache:!1,beforeSend:function(){a(".loadingDiv").show()},error:function(){a(".loadingDiv").hide(),console.log(j.ajaxError)},success:function(d){a(".loadingDiv").hide(),"REP_FOUND"==d?(a(j.modalSelector).modal("hide"),a(j.modalEditPromptSelector+" .modal-header").html("<h4>"+j.eventText+k.title+"</h4>"),a(j.modalEditPromptSelector+" .modal-body-custom").css("padding","15px").html(j.repetitiveEventActionText),a(j.modalEditPromptSelector).modal("show"),a("[data-option=\"save-this\"]").unbind("click").on("click",function(d){p(b,c),a(j.modalEditPromptSelector).modal("hide"),a(j.modalSelector).modal("hide"),d.preventDefault()}),a("[data-option=\"save-repetitives\"]").unbind("click").on("click",function(d){p(b,c,"true"),a(j.modalEditPromptSelector).modal("hide"),a(j.modalSelector).modal("hide"),d.preventDefault()})):p(b,c)},error:function(){alert(j.generalFailureMessage)}})},p=function(b,c,d){d===void 0?editFormData.append("id",b):(editFormData.append("id",b),editFormData.append("rep_id",k.rep_id),editFormData.append("method","repetitive_event")),editFormData.append("otitle",k.title),a.ajax({type:"POST",url:j.ajaxEventEdit,data:c,cache:!1,processData:!1,contentType:!1,beforeSend:function(){a(".loadingDiv").show()},error:function(){a(".loadingDiv").hide(),console.log(j.ajaxError)},success:function(b){a(".loadingDiv").hide(),""==b?(a(j.modalSelector).modal("hide"),a(j.calendarSelector).fullCalendar("refetchEvents")):alert(j.failureUpdateEventMessage)},error:function(){alert(j.failureUpdateEventMessage)}})},q=function(b){var c="id="+b;a.ajax({type:"POST",url:j.ajaxRepeatCheck,data:{id:b},cache:!1,beforeSend:function(){a(".loadingDiv").show()},error:function(){a(".loadingDiv").hide(),console.log(j.ajaxError)},success:function(d){a(".loadingDiv").hide(),"REP_FOUND"==d?(a(j.modalSelector).modal("hide"),a(j.modalPromptSelector+" .modal-header").html("<h4>"+j.eventText+k.title+"</h4>"),a(j.modalPromptSelector+" .modal-body").html(j.repetitiveEventActionText),a(j.modalPromptSelector).modal("show"),a("[data-option=\"remove-this\"]").unbind("click").on("click",function(b){r(c),a(j.modalPromptSelector).modal("hide"),b.preventDefault()}),a("[data-option=\"remove-repetitives\"]").unbind("click").on("click",function(c){var d="id="+b+"&rep_id="+k.rep_id+"&method=repetitive_event&delete=yes";r(d),a(j.modalPromptSelector).modal("hide"),c.preventDefault()})):r(c)},error:function(){alert(j.generalFailureMessage)}})},r=function(b){var c=b+"&title="+encodeURIComponent(k.title)+"&start="+k.d_startDate;a.ajax({type:"POST",url:j.ajaxEventDelete,data:c,cache:!1,beforeSend:function(){a(".loadingDiv").show()},error:function(){a(".loadingDiv").hide(),console.log(j.ajaxError)},success:function(b){a(".loadingDiv").hide(),""==b?(a(j.modalSelector).modal("hide"),a(j.calendarSelector).fullCalendar("refetchEvents")):alert(j.failureDeleteEventMessage)}})},s=function(a,b,c,d){var e="&method=export&id="+encodeURIComponent(a)+"&title="+encodeURIComponent(b)+"&start_date="+encodeURIComponent(c)+"&end_date="+encodeURIComponent(d);window.location=j.ajaxEventExport+e};calendar.calendarImport=function(){txt="import="+encodeURIComponent(a("#import_content").val()),a.post(j.ajaxImport,txt,function(b){alert(b),a(j.calendarSelector).fullCalendar("refetchEvents"),a("#cal_import").modal("hide"),a("#import_content").val("")})};var t=function(a,b){for(var c=0;c<b.length;c++)a.hasOwnProperty(b[c])&&delete a[b[c]]};if(!0==j.filter){function b(){value=a(j.formSearchSelector+" input").val(),construct="search="+encodeURIComponent(value),a.post("includes/loader.php",construct,function(){a(j.calendarSelector).fullCalendar("refetchEvents")})}a(j.formFilterSelector).on("change",function(b){selected_value=a(this).val(),construct="filter="+encodeURIComponent(selected_value),a.post("includes/loader.php",construct,function(){a(j.calendarSelector).fullCalendar("refetchEvents")}),b.preventDefault()}),a(j.formSearchSelector).keypress(function(a){13==a.which&&(b(),a.preventDefault())}),a(j.formSearchSelector+" button").on("click",function(){b()}),window.onbeforeunload=function(){var b=new FormData;b.append("search",""),b.append("filter",a(j.formFilterSelector+" option:selected").val()),navigator.sendBeacon("includes/loader.php",b)}}}})})(jQuery);var editFormData,formData,calendar={};